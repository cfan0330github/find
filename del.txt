char *modDomaindnsCfgFile(int actiontype,char *strDomain,char *strResValue,char *strResHost,char *strResType,char *strResOldvalue,int intMxlevel)
{
        FILE *f_date, *f_tmpfile;
        int intFound=0;
        char *strFilenametemp , *strConfigFile , *strDomainpath, *strToWritevalue ,*strToReplacevalue  ;
        char strTempLine[512];
        strDomainpath = (char *)malloc(strlen(strDomain) + 100);
        getDomaindir(strDomainpath,strDomain);
        strConfigFile = (char *)malloc(strlen(strDomainpath) + 100);
        sprintf(strConfigFile,"%s%s.name",strDomainpath,strDomain);
        strFilenametemp =(char *)malloc(strlen(strConfigFile) + 10 );
        strToWritevalue = (char *)malloc(strlen(strResType)  + strlen(strResHost)  +strlen(strResValue) + 100);
        strToReplacevalue= (char *)malloc(strlen(strResType)  + strlen(strResHost)  +strlen(strResOldvalue) + 100);
        sprintf(strFilenametemp,"%s.swf",strConfigFile);
        if(lockp(strFilenametemp))
        {
                printf("lock file %s\n",strFilenametemp);
                return  REGMSG_604 ;
        }
        f_date = fopen(strConfigFile, "r");
        if(f_date == NULL)
        {
                unlockp(strFilenametemp);
                return REGMSG_604;
        }
        f_tmpfile = fopen(strFilenametemp, "w");
        if(f_tmpfile == NULL)
        {
                fclose(f_date);
                unlockp(strFilenametemp);
                return REGMSG_604;
        }
        switch(actiontype) {
                case 0:
                        if(!strcmp(strResType,DEFAULTMXTYPE))
                        {
                                if(strchr(strResValue,'.') && (strlen(strrchr(strResValue,'.'))!=1))
                                        sprintf(strToWritevalue,"%s\tIN\tMX\t%d\t%s.\n",strResHost,intMxlevel,strResValue);
                                else
                                        sprintf(strToWritevalue,"%s\tIN\tMX\t%d\t%s\n",strResHost,intMxlevel,strResValue);
                        }
                        if(!strcmp(strResType,DEFAULTATYPE))
                                sprintf(strToWritevalue,"%s\tIN\tA\t%s\n",strResHost,strResValue);
                        if(!strcmp(strResType,DEFAULTCNAMETYPE))
                        {
                                if(strchr(strResValue,'.') && (strlen(strrchr(strResValue,'.'))!=1))
                                        sprintf(strToWritevalue,"%s\tIN\tCNAME\t%s.\n",strResHost,strResValue);
                                else
                                        sprintf(strToWritevalue,"%s\tIN\tCNAME\t%s\n",strResHost,strResValue);
                        }
			/* add by sjwxl*/
			if (!strcmp(strResType,DEFAULTTXTTYPE)){
				 sprintf(strToWritevalue,"%s\tIN\tTXT\t\"%s\"\n",strResHost,strResValue);
			}
                        while(!feof(f_date))
                        {
                                bzero(strTempLine, sizeof(strTempLine));
                                fgets(strTempLine, 511, f_date);
                                if(strCASEstr(strTempLine,strToWritevalue))
                                {
                                        bzero(strTempLine, sizeof(strTempLine));
                                }
                                if(strTempLine[0]=='\n')
                                {
                                        bzero(strTempLine, sizeof(strTempLine));
                                }
                                fputs(strTempLine,f_tmpfile);
                        }
                        fprintf(f_tmpfile,"%s",strToWritevalue);
                        break;
                case 1:
                        if(!strcmp(strResType,DEFAULTMXTYPE))
                        {
                                if(strchr(strResOldvalue,'.') && (strlen(strrchr(strResOldvalue,'.'))!=1))
                                        sprintf(strToReplacevalue,"%s\tIN\tMX\t%d\t%s.\n",strResHost,intMxlevel,strResOldvalue);
                                else
                                        sprintf(strToReplacevalue,"%s\tIN\tMX\t%d\t%s\n",strResHost,intMxlevel,strResOldvalue);
                        }
                        if(!strcmp(strResType,DEFAULTATYPE))
                                sprintf(strToReplacevalue,"%s\tIN\tA\t%s\n",strResHost,strResOldvalue);
                        if(!strcmp(strResType,DEFAULTCNAMETYPE))
                        {
                                if(strchr(strResOldvalue,'.') && (strlen(strrchr(strResOldvalue,'.'))!=1))
                                        sprintf(strToReplacevalue,"%s\tIN\tCNAME\t%s.\n",strResHost,strResOldvalue);
                                else
                                        sprintf(strToReplacevalue,"%s\tIN\tCNAME\t%s\n",strResHost,strResOldvalue);
                        }
                        if(!strcmp(strResType,DEFAULTTXTTYPE))
			         sprintf(strToReplacevalue,"%s\tIN\tTXT\t\"%s\"\n",strResHost,strResOldvalue);
							 
                        while(!feof(f_date))
                        {
                                bzero(strTempLine, sizeof(strTempLine));
                                fgets(strTempLine, 511, f_date);
                                if(strCASEstr(strTempLine,strToReplacevalue))
                                {
                                        if(!strcmp(strResType,DEFAULTMXTYPE))
                                        {
                                                if(strchr(strResValue,'.') && (strlen(strrchr(strResValue,'.'))!=1))
                                                        sprintf(strToWritevalue,"%s\tIN\tMX\t%d\t%s.\n",strResHost,intMxlevel,strResValue);
                                                else
                                                        sprintf(strToWritevalue,"%s\tIN\tMX\t%d\t%s\n",strResHost,intMxlevel,strResValue);
                                        }
                                        if(!strcmp(strResType,DEFAULTATYPE))
                                                sprintf(strToWritevalue,"%s\tIN\tA\t%s\n",strResHost,strResValue);
					if(!strcmp(strResType,DEFAULTTXTTYPE))
						sprintf(strToWritevalue,"%s\tIN\tTXT\t\"%s\"\n",strResHost,strResValue);														  
                                        if(!strcmp(strResType,DEFAULTCNAMETYPE))
                                        {
                                                if(strchr(strResValue,'.') && (strlen(strrchr(strResValue,'.'))!=1))
                                                        sprintf(strToWritevalue,"%s\tIN\tCNAME\t%s.\n",strResHost,strResValue);
                                                else
                                                        sprintf(strToWritevalue,"%s\tIN\tCNAME\t%s\n",strResHost,strResValue);
                                        }
                                        fprintf(f_tmpfile,"%s",strToWritevalue);
                                        bzero(strTempLine, sizeof(strTempLine));
                                }
                                if(strTempLine[0]=='\n')
                                {
                                        bzero(strTempLine, sizeof(strTempLine));
                                }
                                fputs(strTempLine,f_tmpfile);
                        }
                        break;
                case 2:
                        if(!strcmp(strResType,DEFAULTMXTYPE))
                        {
                                if(strchr(strResOldvalue,'.') && (strlen(strrchr(strResOldvalue,'.'))!=1))
                                        sprintf(strToReplacevalue,"%s\tIN\tMX\t%d\t%s.\n",strResHost,intMxlevel,strResOldvalue);
                                else
                                        sprintf(strToReplacevalue,"%s\tIN\tMX\t%d\t%s\n",strResHost,intMxlevel,strResOldvalue);
                        }
                        if(!strcmp(strResType,DEFAULTATYPE))
                                sprintf(strToReplacevalue,"%s\tIN\tA\t%s\n",strResHost,strResOldvalue);
                        if(!strcmp(strResType,DEFAULTTXTTYPE))
			        sprintf(strToReplacevalue,"%s\tIN\tTXT\t\"%s\"\n",strResHost,strResOldvalue);
                        if(!strcmp(strResType,DEFAULTCNAMETYPE))
                        {
                                if(strchr(strResOldvalue,'.') && (strlen(strrchr(strResOldvalue,'.'))!=1))
                                        sprintf(strToReplacevalue,"%s\tIN\tCNAME\t%s.\n",strResHost,strResOldvalue);
                                else
                                        sprintf(strToReplacevalue,"%s\tIN\tCNAME\t%s\n",strResHost,strResOldvalue);
                        }
                        while(!feof(f_date))
                        {
                                bzero(strTempLine, sizeof(strTempLine));
                                fgets(strTempLine, 511, f_date);
                                if(strCASEstr(strTempLine,strToReplacevalue))
                                {
                                        bzero(strTempLine, sizeof(strTempLine));
                                }
                                if(strTempLine[0]=='\n')
                                {
                                        bzero(strTempLine, sizeof(strTempLine));
                                }
                                fputs(strTempLine,f_tmpfile);
                        }
                        break;
        }
        fputs("\n",f_tmpfile);
        fflush(f_tmpfile);
        fclose(f_tmpfile);
        fclose(f_date);
        rename(strFilenametemp,strConfigFile);
        chmod(strConfigFile,0664);
        free(strToReplacevalue);
        free(strToWritevalue);
        free(strFilenametemp);
        free(strConfigFile);
        free(strDomainpath);
        return REGMSG_200;
}
